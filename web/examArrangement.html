<head>
  <meta charset="UTF-8">
  <title>考试安排</title>
  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/font-awesome.css" rel="stylesheet" >
  <style>
    .view{
      text-align: center !important;
    }
    td{
      vertical-align: middle !important;
    }
    * {
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      width: 100%;
    }
  </style>
  <script src="../javascript/js/popper.min.js"></script>
  <script src="../javascript/js/bootstrap.min.js"></script>
  <script src="../javascript/js/axios.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-sm bg-dark navbar-dark "><!--顶部导航栏-->
  <a class="navbar-brand" href="#"> <img src="../web/assets/favicon2.ico" alt="Logo" style="width:40px;"> </a>
  <span class="navbar-text">
    在线学习中心
  </span>
  <div class="nav-item dropdown ml-auto">
    <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
<!--        <? echo $_SESSION['name']; ?>-->
    </a>
    <div class="dropdown-menu ">
      <a class="dropdown-item" href="">主页</a>
      <a class="dropdown-item" href="KG/index.html">退出</a>
    </div>
  </div>
</nav><!--顶部导航栏-->

<ol class="breadcrumb">
  <li class="breadcrumb-item active"><a href="#">首页</a></li>
  <li class="breadcrumb-item"><a href="#">考试安排</a></li>
</ol>
<div class="container">
  <h2>考试安排</h2>
  <div class="row no-gutters">
    <div class="input-group col-xl-5">
        <label for="mail"></label>
        <input type="text" class="form-control" placeholder="输入考试名称" id="mail" name="email">
      <div class="input-group-append">
        <button class="btn btn-primary"><i class="fa fa-search" aria-hidden="true"></i></button>
      </div>
    </div>
  </div>
  <br>
  <table id="table" class="table table-hover table-bordered table-responsive-xl text-center vertical-alignment" style="background-color: white">
    <thead class="thead-light text-center">
    <tr>
      <th>测试名称</th>
      <th>测试编号</th>
      <th>测试时间</th>
      <th>测试时长</th>
      <th>距离开考</th>
      <th>操作</th>
    </tr>
    </thead>
    <tbody>
    <script type="module">
      import getData from '../javascript/function.js';
      import {countdown} from "../javascript/function.js";
      let getWeight = await getData("sql",`SELECT * FROM \`exam_arrangement\``, 'weight');
      let tbody = document.querySelector('tbody');
      for (let i=0; i < getWeight.length ;i++)
      {
        let tr = document.createElement('tr');
        tbody.appendChild(tr);
        let data = getWeight[i];
        let td1 = document.createElement('td');
        td1.innerHTML = data['exam_name'];
        tr.appendChild(td1);
        let td2 = document.createElement('td');
        td2.innerHTML = data['exam_id'];
        tr.appendChild(td2);
        let td3 = document.createElement('td');
        if (data['exam_setting'] === 'N')
        {
          td3.innerHTML = "未指定时间";
        }
        else
        {
          td3.innerHTML = new Date(data['exam_begin']).toLocaleString();
        }
        tr.appendChild(td3);
        let td4 = document.createElement('td');
        td4.innerHTML = data['exam_time'] + "分钟";
        tr.appendChild(td4);
        let td5 = document.createElement('td');
        let cd = "ct" + i;
        td5.innerHTML = "<td>\n" +
                "<div id="+cd+">\n" +
                "</div></td>";
        tr.appendChild(td5);

        //设置1s刷新一次获取最新倒计时
        function getCountdown(){
          let ct = document.getElementById("ct"+i);
          ct.innerHTML = countdown(new Date(data['exam_begin']));
        }
        window.setInterval(getCountdown,1000);

        //todo 实现按钮功能
        let td6 = document.createElement('td');
        td6.innerHTML = "<td>\n" +
                "<button id = \"bt"+i+"\" class=\"btn btn-primary btn-sm\" onclick=alert('待完成点击函数跳转')>操作</button>\n" +
                "</div></td>";
        tr.appendChild(td6);
      }
    </script>
    </tbody>
  </table>
</div>
<script type="text/javascript" color="255,100,0" pointColor="255,0,0" opacity='0.7' zIndex="-2" count="150" src="../javascript/js/canvas-nest.js"></script>
<script type="text/javascript" src="../javascript/js/canvas-nest.umd.js"></script>
</body>